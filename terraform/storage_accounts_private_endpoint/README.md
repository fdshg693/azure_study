# Storage Accounts with Private Endpoint - Terraformæ§‹æˆ

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Azure Storage Accountsã‚’Private EndpointçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹Terraformæ§‹æˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“‹ æ¦‚è¦

ã“ã®Terraformæ§‹æˆã¯ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

1. **Storage Account** - Blobã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å«ã‚€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
2. **Virtual Network (VNet)** - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
3. **Subnets** - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã¨VMç”¨ã®2ã¤ã®ã‚µãƒ–ãƒãƒƒãƒˆ
4. **Private Endpoint** - Storage Accountã®Blobã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ¥ç¶š
5. **Private DNS Zone** - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®DNSè§£æ±ºç”¨
6. **Test VM (Optional)** - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆç”¨Linux VM
7. **Blob Container & File** - ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚³ãƒ³ãƒ†ãƒŠ

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure Subscription                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Resource Group                              â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚  Virtual Network (10.0.0.0/16)          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Private Endpoint Subnet        â”‚     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ (10.0.1.0/24)                  â”‚     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                 â”‚     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Private Endpoint      â”‚      â”‚     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ (10.0.1.x)            â”‚â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                          â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ VM Subnet (10.0.2.0/24)        â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                 â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Test VM               â”‚      â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ (10.0.2.x)            â”‚      â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                          â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚  â”‚
â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ Private DNS Zone                          â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ privatelink.blob.core.windows.net        â”‚     â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚  â”‚
â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚                                                              â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚  â”‚  Storage Account                                   â”‚      â”‚  â”‚
â”‚  â”‚                                                    â”‚      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚â—„â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â”‚ Blob Service     â”‚  Public Access: Disabled    â”‚         â”‚
â”‚  â”‚  â”‚                  â”‚  Private Endpoint: Enabled  â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
storage_accounts_private_endpoint/
â”œâ”€â”€ provider.tf          # Terraformã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¨­å®š
â”œâ”€â”€ variables.tf         # å¤‰æ•°å®šç¾©ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªå€¤ï¼‰
â”œâ”€â”€ main.tf              # ãƒ¡ã‚¤ãƒ³ãƒªã‚½ãƒ¼ã‚¹å®šç¾©ï¼ˆVNetã€Storageã€Private Endpointç­‰ï¼‰
â”œâ”€â”€ vm.tf                # ãƒ†ã‚¹ãƒˆç”¨VMå®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”œâ”€â”€ outputs.tf           # å‡ºåŠ›å€¤å®šç¾©ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®æƒ…å ±è¡¨ç¤ºï¼‰
â”œâ”€â”€ sample.txt           # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ README.md            # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

1. **Azure CLI**ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
   ```powershell
   az --version
   ```

2. **Terraform**ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ˆv1.0ä»¥ä¸Šæ¨å¥¨ï¼‰
   ```powershell
   terraform --version
   ```

3. **Azureã«ãƒ­ã‚°ã‚¤ãƒ³**ã—ã¦ã„ã‚‹
   ```powershell
   az login
   az account show
   ```

### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

1. **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•**
   ```powershell
   cd c:\CodeStudy\azure_study\terraform\storage_accounts_private_endpoint
   ```

2. **å¤‰æ•°ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**
   
   `variables.tf`ã‚’ç·¨é›†ã—ã¦ã€ä»¥ä¸‹ã®å€¤ã‚’å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´:
   - `storage_account_name`: Storage Accountåï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
   - `admin_password`: VMç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆå¿…ãšå¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰
   - `location`: ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³

   ã¾ãŸã¯ã€`terraform.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:
   ```hcl
   storage_account_name = "mystorageacct12345"
   admin_password       = "YourSecurePassword123!"
   location             = "Japan East"
   ```

3. **Terraformã®åˆæœŸåŒ–**
   ```powershell
   terraform init
   ```

4. **å®Ÿè¡Œãƒ—ãƒ©ãƒ³ã®ç¢ºèª**
   ```powershell
   terraform plan
   ```
   
   ä½œæˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

5. **ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```powershell
   terraform apply
   ```
   
   `yes`ã‚’å…¥åŠ›ã—ã¦å®Ÿè¡Œã‚’ç¢ºèªã—ã¾ã™ã€‚
   
   ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯5-10åˆ†ç¨‹åº¦ã‹ã‹ã‚Šã¾ã™ã€‚

6. **å‡ºåŠ›æƒ…å ±ã®ç¢ºèª**
   ```powershell
   # ã™ã¹ã¦ã®å‡ºåŠ›ã‚’è¡¨ç¤º
   terraform output
   
   # ç‰¹å®šã®å‡ºåŠ›ã‚’è¡¨ç¤º
   terraform output vm_public_ip
   terraform output ssh_command
   ```

## ğŸ§ª å‹•ä½œç¢ºèª

### 1. VMã¸ã®SSHæ¥ç¶š

```powershell
# SSHæ¥ç¶šã‚³ãƒãƒ³ãƒ‰ã‚’å–å¾—
terraform output -raw ssh_command

# å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼ˆä¾‹ï¼‰
ssh azureuser@<VMã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP>
```

### 2. ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ

VMã«æ¥ç¶šå¾Œã€ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

```bash
# DNSè§£æ±ºã®ç¢ºèªï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«è§£æ±ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
nslookup <storage_account_name>.blob.core.windows.net

# ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ 10.0.1.x ã®ç¯„å›²ã§ã‚ã‚‹ã¹ã

# HTTPSã§ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
curl -I https://<storage_account_name>.blob.core.windows.net/

# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
./test_storage.sh
```

### 3. Azure CLIã‚’ä½¿ç”¨ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

VMã‹ã‚‰å®Ÿè¡Œ:

```bash
# Azureã«ãƒ­ã‚°ã‚¤ãƒ³
az login

# ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
az storage blob upload \
  --account-name <storage_account_name> \
  --container-name private-container \
  --name test-from-vm.txt \
  --file /etc/hostname \
  --auth-mode login

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
az storage blob list \
  --account-name <storage_account_name> \
  --container-name private-container \
  --auth-mode login \
  --output table
```

### 4. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰å®Ÿè¡Œï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ç’°å¢ƒï¼‰:

```powershell
# ã“ã‚Œã¯å¤±æ•—ã™ã‚‹ã¯ãšï¼ˆpublic_network_access_enabled = false ã®ãŸã‚ï¼‰
curl https://<storage_account_name>.blob.core.windows.net/
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **VMç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…ãšå¤‰æ›´ã—ã¦ãã ã•ã„
   - æœ¬ç•ªç’°å¢ƒã§ã¯SSHå…¬é–‹éµèªè¨¼ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„

2. **NSGãƒ«ãƒ¼ãƒ«ã®åˆ¶é™**
   - SSHã‚¢ã‚¯ã‚»ã‚¹ã‚’ç‰¹å®šã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«åˆ¶é™ã—ã¦ãã ã•ã„
   - æœ¬ç•ªç’°å¢ƒã§ã¯ã€Azure Bastion ã®ä½¿ç”¨ã‚’æ¨å¥¨

3. **Storage Accountã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã®ç®¡ç†**
   - ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¯å®‰å…¨ã«ä¿ç®¡ã—ã¦ãã ã•ã„
   - å¯èƒ½ãªé™ã‚Š Azure AD èªè¨¼ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
   - å®šæœŸçš„ã«ã‚­ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ãã ã•ã„

4. **ã‚¿ã‚°ã®æ´»ç”¨**
   - ã‚³ã‚¹ãƒˆç®¡ç†ã¨æ•´ç†ã®ãŸã‚ã€é©åˆ‡ãªã‚¿ã‚°ã‚’è¨­å®šã—ã¦ãã ã•ã„

## ğŸ’° ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆæ¦‚ç®—ã€Japan Eastãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰

| ãƒªã‚½ãƒ¼ã‚¹ | æœˆé¡ã‚³ã‚¹ãƒˆï¼ˆæ¦‚ç®—ï¼‰ |
|---------|-------------------|
| Storage Account (LRS, 10GB) | Â¥200-300 |
| Private Endpoint | Â¥800-1,000 |
| Private DNS Zone | Â¥60-80 |
| VM (Standard_B1s) | Â¥1,200-1,500 |
| Public IP (Static) | Â¥400-500 |
| **åˆè¨ˆ** | **ç´„ Â¥2,660-3,380** |

â€»å®Ÿéš›ã®ã‚³ã‚¹ãƒˆã¯ä½¿ç”¨é‡ã‚„ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã£ã¦å¤‰å‹•ã—ã¾ã™

### ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãƒ’ãƒ³ãƒˆ

- ãƒ†ã‚¹ãƒˆå¾Œã¯ä¸è¦ãªVMã‚’å‰Šé™¤ã™ã‚‹
- Standard_B1s VMã®ä½¿ç”¨æ™‚é–“ã‚’æœ€å°é™ã«ã™ã‚‹
- ä¸è¦ãªå ´åˆã¯ `vm.tf` ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦VMã‚’ä½œæˆã—ãªã„

## ğŸ—‘ï¸ ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯:

```powershell
terraform destroy
```

`yes`ã‚’å…¥åŠ›ã—ã¦å‰Šé™¤ã‚’ç¢ºèªã—ã¾ã™ã€‚

â€»å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã‚‹ã¾ã§æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

## ğŸ“š è¿½åŠ ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚ªãƒ—ã‚·ãƒ§ãƒ³

### VMã‚’ä½œæˆã—ãªã„å ´åˆ

ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã—ãŸã„ã€ã¾ãŸã¯VMãŒä¸è¦ãªå ´åˆ:

1. `vm.tf` ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’å¤‰æ›´:
   ```powershell
   Rename-Item vm.tf vm.tf.disabled
   ```

2. ã¾ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ

### ä»–ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 

`main.tf` ã®æœ«å°¾ã«ã‚ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã€Fileã€Queueã€Tableã€Dfsã‚µãƒ¼ãƒ“ã‚¹ç”¨ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚

### è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ

`main.tf` ã«è¿½åŠ ã®ã‚³ãƒ³ãƒ†ãƒŠãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©:

```hcl
resource "azurerm_storage_container" "additional" {
  name                  = "another-container"
  storage_account_name  = azurerm_storage_account.main.name
  container_access_type = "private"
}
```

## ğŸ“– ä½¿ç”¨å¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°

### Storage Account ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | å€¤ã®ä¾‹ |
|-----------|------|--------|
| `account_tier` | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚£ã‚¢ | `Standard`, `Premium` |
| `account_replication_type` | ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ | `LRS`, `GRS`, `RAGRS`, `ZRS`, `GZRS`, `RAGZRS` |
| `account_kind` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç¨®é¡ | `StorageV2`, `BlobStorage`, `FileStorage`, `BlockBlobStorage` |
| `access_tier` | ã‚¢ã‚¯ã‚»ã‚¹é »åº¦ | `Hot`, `Cool` |
| `min_tls_version` | æœ€å°TLSãƒãƒ¼ã‚¸ãƒ§ãƒ³ | `TLS1_0`, `TLS1_1`, `TLS1_2` |
| `public_network_access_enabled` | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ | `true`, `false` |
| `allow_nested_items_to_be_public` | Blobå…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ | `true`, `false` |
| `shared_access_key_enabled` | ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ä½¿ç”¨è¨±å¯ | `true`, `false` |

### Blob ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | å€¤ã®ä¾‹ |
|-----------|------|--------|
| `type` | Blobã‚¿ã‚¤ãƒ— | `Block`, `Page`, `Append` |
| `access_tier` | ã‚¢ã‚¯ã‚»ã‚¹éšå±¤ | `Hot`, `Cool`, `Archive` |
| `content_type` | MIMEã‚¿ã‚¤ãƒ— | `text/plain`, `application/json`, `image/png` |
| `content_encoding` | ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | `gzip`, `deflate` |
| `cache_control` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡ | `max-age=3600` |

### Private Endpoint ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | å€¤ã®ä¾‹ |
|-----------|------|--------|
| `subresource_names` | æ¥ç¶šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ | `blob`, `file`, `queue`, `table`, `dfs`, `web` |
| `is_manual_connection` | æ‰‹å‹•æ‰¿èª | `true`, `false` |

### VM ã‚µã‚¤ã‚ºã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚µã‚¤ã‚º | vCPU | ãƒ¡ãƒ¢ãƒª | ç”¨é€” |
|--------|------|--------|------|
| `Standard_B1s` | 1 | 1 GB | é–‹ç™º/ãƒ†ã‚¹ãƒˆï¼ˆæœ€å°æ§‹æˆï¼‰ |
| `Standard_B2s` | 2 | 4 GB | å°è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ |
| `Standard_D2s_v3` | 2 | 8 GB | æ±ç”¨ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ |
| `Standard_D4s_v3` | 4 | 16 GB | ä¸­è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ |
